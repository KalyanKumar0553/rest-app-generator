<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()" aria-label="Close modal">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="modal-header">
      <div class="icon-wrapper">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 10H3M16 2V6M8 2V6M7.8 22H16.2C17.8802 22 18.7202 22 19.362 21.673C19.9265 21.3854 20.3854 20.9265 20.673 20.362C21 19.7202 21 18.8802 21 17.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V17.2C3 18.8802 3 19.7202 3.32698 20.362C3.6146 20.9265 4.07354 21.3854 4.63803 21.673C5.27976 22 6.11984 22 7.8 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2>Verify Your Email</h2>
      <p class="subtitle">We've sent a 6-digit verification code to</p>
      <p class="email">{{ email }}</p>
    </div>

    <div class="modal-body">
      <div class="otp-input-group">
        <input
          *ngFor="let digit of otpDigits; let i = index"
          [id]="'otp-' + i"
          type="text"
          maxlength="1"
          class="otp-input"
          [(ngModel)]="otpDigits[i]"
          (input)="onOtpInput($event, i)"
          (keydown)="onOtpKeyDown($event, i)"
          (paste)="i === 0 ? onOtpPaste($event) : null"
          [disabled]="isLoading"
          inputmode="numeric"
          pattern="[0-9]"
        />
      </div>

      <div class="timer-section" *ngIf="!canResend">
        <p class="timer-text">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          OTP expires in {{ formattedTime }}
        </p>
      </div>

      <div class="resend-section">
        <p class="resend-text">
          Didn't receive the code?
          <button
            class="resend-btn"
            (click)="resendOTP()"
            [disabled]="!canResend || isLoading"
            [class.disabled]="!canResend"
          >
            {{ canResend ? 'Resend OTP' : 'Resend available in ' + formattedTime }}
          </button>
        </p>
      </div>

      <button
        class="btn-verify"
        (click)="verifyOTP()"
        [disabled]="!isOtpComplete || isLoading"
      >
        <span *ngIf="!isLoading">Verify OTP</span>
        <span *ngIf="isLoading" class="loading-spinner">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" opacity="0.25"/>
            <path d="M10 2C5.58172 2 2 5.58172 2 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Verifying...
        </span>
      </button>
    </div>
  </div>
</div>
