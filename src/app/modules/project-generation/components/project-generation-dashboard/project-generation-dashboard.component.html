<app-confirmation-modal
  *ngIf="showBackConfirmation"
  [title]="backConfirmationConfig.title"
  [message]="backConfirmationConfig.message"
  [buttons]="backConfirmationConfig.buttons"
  (confirm)="confirmBack()"
  (cancel)="cancelBack()"
></app-confirmation-modal>

<div class="mobile-header">
  <div class="logo">
    <span class="logo-text">Bootify</span>
    <i class="bi bi-code-slash logo-icon"></i>
  </div>
  <div class="spacer"></div>
  <button class="menu-toggle" (click)="toggleSidebar()" aria-label="Toggle menu">
    <i class="bi bi-list"></i>
  </button>
</div>

<div class="sidebar-overlay" [class.show]="isSidebarOpen" (click)="closeSidebar()"></div>

<div class="project-dashboard-container">
  <aside class="sidebar" [class.open]="isSidebarOpen">
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-text">Bootify</span>
        <i class="bi bi-code-slash logo-icon"></i>
      </div>
    </div>

    <nav class="sidebar-nav">
      <button class="nav-item active" (click)="navigateToSection('general')">
        <i class="bi bi-globe"></i>
        <span>General</span>
      </button>
      <button class="nav-item" (click)="navigateToSection('entities')">
        <i class="bi bi-database"></i>
        <span>Entities</span>
      </button>
      <button class="nav-item" (click)="navigateToSection('data-objects')">
        <i class="bi bi-diagram-3"></i>
        <span>Data Objects</span>
      </button>
      <button class="nav-item" (click)="navigateToSection('collaborate')">
        <i class="bi bi-people"></i>
        <span>Collaborate</span>
      </button>
      <button class="nav-item" (click)="navigateToSection('explore')">
        <i class="bi bi-search"></i>
        <span>Explore</span>
      </button>
      <button class="nav-item" (click)="navigateToSection('download')">
        <i class="bi bi-download"></i>
        <span>Download</span>
      </button>
    </nav>
  </aside>

  <main class="main-content">
    <div class="content-body" id="general">
      <div class="top-actions">
        <button class="back-btn-desktop" (click)="handleBack()" aria-label="Go back" mat-stroked-button>
          <mat-icon>arrow_back</mat-icon>
          Back
        </button>
      </div>

      <div class="info-banner" *ngIf="showInfoBanner">
        <div class="info-content">
          <p>
            Define global project settings. Learn <a href="#" class="info-link">in the docs</a>.
          </p>
        </div>
        <button class="close-banner-btn" (click)="closeInfoBanner()" aria-label="Close banner">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-accordion class="expansion-panels">
        <mat-expansion-panel [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              Project settings
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="panel-content">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Project group</mat-label>
              <input matInput [(ngModel)]="projectSettings.projectGroup" placeholder="io.bootify">
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Project name</mat-label>
              <input matInput [(ngModel)]="projectSettings.projectName" placeholder="my-app">
            </mat-form-field>

            <div class="form-row">
              <label class="field-label">Build type</label>
              <mat-radio-group [(ngModel)]="projectSettings.buildType" class="radio-group-horizontal">
                <mat-radio-button value="gradle">Gradle</mat-radio-button>
                <mat-radio-button value="maven">Maven</mat-radio-button>
              </mat-radio-group>
            </div>

            <div class="form-row">
              <label class="field-label">Language</label>
              <mat-radio-group [(ngModel)]="projectSettings.language" class="radio-group-horizontal">
                <mat-radio-button value="java">Java</mat-radio-button>
                <mat-radio-button value="kotlin">Kotlin</mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Frontend</mat-label>
              <mat-select [(ngModel)]="projectSettings.frontend">
                <mat-option *ngFor="let option of frontendOptions" [value]="option.toLowerCase()">
                  {{ option }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix matTooltip="Select a frontend framework for your project">info</mat-icon>
            </mat-form-field>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Database settings
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="panel-content">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Database</mat-label>
              <mat-select [(ngModel)]="databaseSettings.database">
                <mat-option *ngFor="let option of databaseOptions" [value]="option">
                  {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>DB Generation</mat-label>
              <mat-select [(ngModel)]="databaseSettings.dbGeneration">
                <mat-option *ngFor="let option of dbGenerationOptions" [value]="option">
                  {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <div class="form-row">
              <mat-checkbox [(ngModel)]="databaseSettings.pluralizeTableNames">
                Pluralize table names
                <mat-icon class="inline-icon" matTooltip="Automatically pluralize table names">info</mat-icon>
              </mat-checkbox>
            </div>

            <div class="form-row">
              <mat-checkbox [(ngModel)]="databaseSettings.addDateCreatedLastUpdated">
                Add dateCreated/lastUpdated to entities
                <mat-icon class="inline-icon" matTooltip="Add timestamp fields to all entities">info</mat-icon>
              </mat-checkbox>
            </div>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Developer preferences
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="panel-content">
            <div class="form-row">
              <label class="field-label">Appl. format</label>
              <mat-radio-group [(ngModel)]="developerPreferences.applFormat" class="radio-group-horizontal">
                <mat-radio-button value="yaml">Yaml</mat-radio-button>
                <mat-radio-button value="properties">Properties</mat-radio-button>
              </mat-radio-group>
            </div>

            <div class="form-row">
              <label class="field-label">Packages
                <mat-icon class="inline-icon" matTooltip="Package organization structure">info</mat-icon>
              </label>
              <mat-radio-group [(ngModel)]="developerPreferences.packages" class="radio-group-horizontal">
                <mat-radio-button value="technical">Technical</mat-radio-button>
                <mat-radio-button value="domain">Domain driven</mat-radio-button>
                <mat-radio-button value="mixed">Mixed</mat-radio-button>
              </mat-radio-group>
            </div>

            <div class="form-row">
              <mat-checkbox [(ngModel)]="developerPreferences.enableOpenAPI">
                Enable OpenAPI/Swagger UI
                <mat-icon class="inline-icon" matTooltip="Generate OpenAPI documentation">info</mat-icon>
              </mat-checkbox>
            </div>

            <div class="form-row">
              <mat-checkbox [(ngModel)]="developerPreferences.useDockerCompose">
                Use Docker compose for development
                <mat-icon class="inline-icon" matTooltip="Include Docker Compose configuration">info</mat-icon>
              </mat-checkbox>
            </div>

            <div class="form-row">
              <label class="field-label">Java version</label>
              <mat-radio-group [(ngModel)]="developerPreferences.javaVersion" class="radio-group-horizontal">
                <mat-radio-button *ngFor="let version of javaVersionOptions" [value]="version">
                  {{ version }}
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Deployment</mat-label>
              <mat-select [(ngModel)]="developerPreferences.deployment">
                <mat-option *ngFor="let option of deploymentOptions" [value]="option">
                  {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Further dependencies
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="panel-content">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Dependencies</mat-label>
              <input
                matInput
                [matAutocomplete]="auto"
                [(ngModel)]="dependencyInput"
                (ngModelChange)="filterDependencies($event)"
                placeholder="Type to search dependencies"
              />
              <mat-icon matSuffix>search</mat-icon>
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addDependency($event)">
                <mat-option *ngFor="let dep of filteredDependencies" [value]="dep">
                  {{ dep }}
                </mat-option>
              </mat-autocomplete>
              <mat-hint>Bootify.io already adds required dependencies. Add your custom dependencies here.</mat-hint>
            </mat-form-field>

            <div class="selected-dependencies" *ngIf="selectedDependencies.length > 0">
              <div class="dependency-chip" *ngFor="let dep of selectedDependencies">
                <span>{{ dep }}</span>
                <button type="button" class="remove-chip" (click)="removeDependency(dep)" aria-label="Remove dependency">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>

      <div class="action-section">
        <button mat-raised-button color="primary" (click)="setupEntities()" [disabled]="isLoading">
          <mat-spinner *ngIf="isLoading" diameter="20" class="button-spinner"></mat-spinner>
          <span *ngIf="!isLoading">Setup Entities</span>
          <span *ngIf="isLoading">Loading...</span>
        </button>
        <button mat-raised-button (click)="saveProject()" [disabled]="isLoading">
          Save Project
        </button>
      </div>
    </div>
  </main>
</div>
