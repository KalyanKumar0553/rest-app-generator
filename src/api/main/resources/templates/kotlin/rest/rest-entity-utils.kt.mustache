package {{supportPackage}}

import java.lang.reflect.Field
import java.lang.reflect.Modifier
import org.springframework.util.ReflectionUtils

object RestEntityUtils {

    fun <T> mergeNonNullFields(source: T, target: T, idField: String) {
        collectFields(source!!::class.java).forEach { field ->
            val modifiers = field.modifiers
            if (Modifier.isStatic(modifiers) || Modifier.isFinal(modifiers) || field.name == idField) {
                return@forEach
            }
            ReflectionUtils.makeAccessible(field)
            val value = ReflectionUtils.getField(field, source)
            if (value != null) {
                ReflectionUtils.setField(field, target, value)
            }
        }
    }

    private fun collectFields(type: Class<*>): List<Field> {
        val fields = mutableListOf<Field>()
        var current: Class<*>? = type
        while (current != null && current != Any::class.java) {
            fields.addAll(current.declaredFields)
            current = current.superclass
        }
        return fields
    }
}
