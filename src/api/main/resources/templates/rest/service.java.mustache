package {{servicePackage}};

import java.util.List;
import java.util.Map;

import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

import {{modelPackage}}.{{entityName}};
import {{repositoryPackage}}.{{repositoryClass}};
import {{supportPackage}}.{{supportClass}};

@Service
@Transactional(readOnly = true)
public class {{serviceClass}} {

    private final {{repositoryClass}} repository;

    public {{serviceClass}}({{repositoryClass}} repository) {
        this.repository = repository;
    }

    @Transactional
    public {{entityName}} create({{entityName}} request) {
        return repository.save(request);
    }

    @Transactional
    public {{entityName}} update({{idType}} id, {{entityName}} request) {
        {{entityName}} existing = getById(id);
        {{supportClass}}.mergeNonNullFields(request, existing, "{{idName}}");
        return repository.save(existing);
    }

    @Transactional
    public void deleteById({{idType}} id) {
        if (!repository.existsById(id)) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "{{entityName}} not found for id: " + id);
        }
        repository.deleteById(id);
    }

    @Transactional
    public void deleteAll() {
        repository.deleteAll();
    }

    public List<{{entityName}}> getAll() {
        return repository.findAll();
    }

    public {{entityName}} getById({{idType}} id) {
        return repository.findById(id)
                .orElseThrow(() -> new ResponseStatusException(HttpStatus.NOT_FOUND, "{{entityName}} not found for id: " + id));
    }

    public List<{{entityName}}> search(Map<String, String> queryParams) {
        if (queryParams == null || queryParams.isEmpty()) {
            return getAll();
        }
        return repository.findAll({{supportClass}}.buildSpecification(queryParams, {{entityName}}.class));
    }
}
