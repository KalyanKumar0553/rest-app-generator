<div class="request-response-grid">
  <mat-accordion class="section-accordion request-accordion" multi="true">
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>Request Configuration</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="request-list">
        <div class="request-item" *ngIf="draft?.methods?.create">
          <div class="request-op-label">Create</div>
          <div class="request-item-body dto-inline">
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select [(ngModel)]="draft.requestResponse.request.create.dtoName">
                <mat-option *ngFor="let option of createRequestOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
            <button type="button" class="dto-add-btn" aria-label="Configure create DTO" (click)="openDtoConfig('create')">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>

        <div class="request-item" *ngIf="draft?.methods?.get">
          <div class="request-op-label">Get By Key</div>
          <div class="request-item-body">
            <div class="input-align-wrap">
              <app-field-type-select
                [label]="'Key Type'"
                [appearance]="'outline'"
                [className]="'dto-input'"
                [options]="idTypeOptions"
                [value]="draft.requestResponse.request.getByIdType"
                (valueChange)="draft.requestResponse.request.getByIdType = $event">
              </app-field-type-select>
            </div>
          </div>
        </div>

        <div class="request-item" *ngIf="draft?.methods?.list">
          <div class="request-op-label">List</div>
          <div class="request-item-body dto-inline">
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select [(ngModel)]="draft.requestResponse.request.list.dtoName">
                <mat-option *ngFor="let option of listRequestOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
            <button type="button" class="dto-add-btn" aria-label="Configure list DTO" (click)="openDtoConfig('list')">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>

        <div class="request-item" *ngIf="draft?.methods?.patch">
          <div class="request-op-label">Patch</div>
          <div class="request-item-body">
            <mat-radio-group class="inline-radio" [(ngModel)]="draft.requestResponse.request.patch.mode">
              <mat-radio-button value="JSON_MERGE_PATCH">JSON Merge</mat-radio-button>
              <mat-radio-button value="JSON_PATCH">JSON Patch</mat-radio-button>
            </mat-radio-group>
          </div>
        </div>

        <div class="request-item" *ngIf="draft?.methods?.delete">
          <div class="request-op-label">Delete</div>
          <div class="request-item-body dto-inline">
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select [(ngModel)]="draft.requestResponse.request.delete.dtoName">
                <mat-option *ngFor="let option of requestDtoOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
            <button type="button" class="dto-add-btn" aria-label="Configure delete DTO" (click)="openDtoConfig('delete')">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>

      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-accordion class="section-accordion" multi="true">
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>Response Configuration</mat-panel-title>
      </mat-expansion-panel-header>

      <mat-radio-group class="stack-radio" [(ngModel)]="draft.requestResponse.response.responseType">
        <mat-radio-button value="RESPONSE_ENTITY">ResponseEntity&lt;T&gt;</mat-radio-button>
        <mat-radio-button value="DTO_DIRECT">Return DTO Directly</mat-radio-button>
        <mat-radio-button value="CUSTOM_WRAPPER">Custom Wrapper Class</mat-radio-button>
      </mat-radio-group>

      <div class="request-list response-list" *ngIf="draft.requestResponse.response.responseType === 'CUSTOM_WRAPPER'">
        <div class="request-item" *ngFor="let operation of selectedResponseOperations">
          <div class="request-op-label">{{ getResponseOperationLabel(operation) }}</div>
          <div class="request-item-body">
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select
                [ngModel]="getResponseEndpointDtoName(operation)"
                (ngModelChange)="setResponseEndpointDtoName(operation, $event)">
                <mat-option *ngFor="let option of getResponseOptions(operation)" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<app-modal
  [isOpen]="showDtoConfigModal"
  [title]="'Add DTO'"
  [size]="'medium'"
  (close)="closeDtoConfig()">
  <app-add-data-object
    #dtoConfigComponent
    [editDataObject]="dtoEditDataObject"
    [isOpen]="showDtoConfigModal"
    [existingDataObjects]="dtoObjects"
    [availableModels]="availableModels"
    [enumTypes]="enumTypes"
    (save)="onDtoConfigSave($event)"
    (cancel)="closeDtoConfig()">
  </app-add-data-object>
  <div modal-footer>
    <button mat-raised-button type="button" (click)="closeDtoConfig()">Cancel</button>
    <button mat-raised-button color="primary" type="button" (click)="saveDtoConfig()">Save</button>
  </div>
</app-modal>
