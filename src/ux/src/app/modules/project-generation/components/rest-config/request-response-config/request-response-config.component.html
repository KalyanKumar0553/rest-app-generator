<section class="section-title-row top-title">
  <h4>Configure Request and Response Data</h4>
  <div class="section-line"></div>
</section>

<div class="request-response-grid">
  <mat-accordion class="section-accordion request-accordion" multi="true">
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>Request Configuration</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="request-list">
        <div class="request-item">
          <div class="request-op-label">Create</div>
          <div class="request-item-body dto-inline">
            <button type="button" class="dto-add-btn" aria-label="Configure create DTO" (click)="openDtoConfig('create')">
              <mat-icon>add</mat-icon>
            </button>
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select [(ngModel)]="draft.requestResponse.request.create.dtoName">
                <mat-option *ngFor="let option of dtoOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div class="request-item">
          <div class="request-op-label">Update (PUT)</div>
          <div class="request-item-body dto-inline">
            <button type="button" class="dto-add-btn" aria-label="Configure update DTO" (click)="openDtoConfig('update')">
              <mat-icon>add</mat-icon>
            </button>
            <mat-form-field appearance="outline" class="dto-input">
              <mat-select [(ngModel)]="draft.requestResponse.request.update.dtoName">
                <mat-option *ngFor="let option of dtoOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div class="request-item">
          <div class="request-op-label">Patch</div>
          <div class="request-item-body">
            <mat-radio-group class="inline-radio" [(ngModel)]="draft.requestResponse.request.patch.mode">
              <mat-radio-button value="JSON_MERGE_PATCH">JSON Merge</mat-radio-button>
              <mat-radio-button value="JSON_PATCH">JSON Patch</mat-radio-button>
            </mat-radio-group>
          </div>
        </div>

        <div class="request-item">
          <div class="request-op-label">Bulk Insert</div>
          <div class="request-item-body">
            <mat-form-field appearance="outline" class="bulk-select">
              <mat-select [(ngModel)]="draft.requestResponse.request.bulkInsertType">
                <mat-option *ngFor="let option of bulkDtoTypeOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div class="request-item">
          <div class="request-op-label">Bulk Update</div>
          <div class="request-item-body">
            <mat-form-field appearance="outline" class="bulk-select">
              <mat-select [(ngModel)]="draft.requestResponse.request.bulkUpdateType">
                <mat-option *ngFor="let option of bulkDtoTypeOptions" [value]="option">{{ option }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-accordion class="section-accordion" multi="true">
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>Response Configuration</mat-panel-title>
      </mat-expansion-panel-header>

      <mat-radio-group class="stack-radio" [(ngModel)]="draft.requestResponse.response.responseType">
        <mat-radio-button value="RESPONSE_ENTITY">ResponseEntity&lt;T&gt;</mat-radio-button>
        <mat-radio-button value="DTO_DIRECT">Return DTO Directly</mat-radio-button>
        <mat-radio-button value="CUSTOM_WRAPPER">Custom Wrapper Class</mat-radio-button>
      </mat-radio-group>

      <div class="section-title-row inner-title">
        <h5>Response Wrapper</h5>
        <div class="section-line"></div>
      </div>

      <mat-radio-group class="wrapper-grid" [(ngModel)]="draft.requestResponse.response.responseWrapper">
        <mat-radio-button value="STANDARD_ENVELOPE">Standard Envelope</mat-radio-button>
        <mat-radio-button value="NONE">None</mat-radio-button>
        <mat-radio-button value="UPSERT">Upsert</mat-radio-button>
      </mat-radio-group>

      <div class="flag-stack">
        <mat-checkbox [(ngModel)]="draft.requestResponse.response.enableFieldProjection" color="primary">Enable Field Projection</mat-checkbox>
        <mat-checkbox [(ngModel)]="draft.requestResponse.response.includeHateoasLinks" color="primary">Include HATEOAS Links</mat-checkbox>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<app-modal
  [isOpen]="showDtoConfigModal"
  [title]="'Add DTO'"
  [size]="'medium'"
  (close)="closeDtoConfig()">
  <app-add-data-object
    #dtoConfigComponent
    [editDataObject]="dtoEditDataObject"
    [isOpen]="showDtoConfigModal"
    [existingDataObjects]="dtoObjects"
    [availableModels]="availableModels"
    [enumTypes]="enumTypes"
    (save)="onDtoConfigSave($event)"
    (cancel)="closeDtoConfig()">
  </app-add-data-object>
  <div modal-footer>
    <button mat-raised-button type="button" (click)="closeDtoConfig()">Cancel</button>
    <button mat-raised-button color="primary" type="button" (click)="saveDtoConfig()">Save</button>
  </div>
</app-modal>
